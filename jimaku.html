 <!DOCTYPE html>
 <html>
 <head>
   <meta charset="utf-8">
   <title>リアルタイム字幕</title>
   <script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dist/kuromoji.js"></script>
 </head>
 <body>
   <h2>リアルタイム字幕（Wikipediaリンク付き）</h2>
   <button id="startButton" disabled>開始</button>
   <div id="output" style="font-size: 1.5em;"></div>
   <script>
     const output = document.getElementById("output");
-    const recognition = new (webkitSpeechRecognition || SpeechRecognition)();
     const startButton = document.getElementById("startButton");
     const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
     recognition.continuous = true;
     recognition.lang = "ja-JP";
 
-    recognition.onresult = async function(event) {
-      const transcript = event.results[event.resultIndex][0].transcript;
-      const linked = await linkToWikipedia(transcript);
-      output.innerHTML += "<p>" + linked + "</p>";
-    };
-
-    async function linkToWikipedia(text) {
-      const keywords = await getKeywords(text);
-      let linkedText = text;
-      for (const word of keywords) {
-        const url = `https://ja.wikipedia.org/wiki/${encodeURIComponent(word)}`;
-        const regex = new RegExp(word, "g");
-        linkedText = linkedText.replace(regex, `<a href="${url}" target="_blank">${word}</a>`);
     let tokenizer = null;
     kuromoji.builder({
       dicPath: "https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/"
-    }).build(function(err, builtTokenizer) {
+    }).build((err, builtTokenizer) => {
       if (!err) {
         tokenizer = builtTokenizer;
         startButton.disabled = false;
       }
-      return linkedText;
-    }
     });
 
-    async function getKeywords(text) {
-      // ここをChatGPT APIなどに置き換えることで精度UP可
-      const commonWords = ["日本", "東京", "AI", "京都", "Apple"];
-      return commonWords.filter(w => text.includes(w));
-    }
     startButton.onclick = () => {
       recognition.start();
       startButton.disabled = true;
     };
 
-    recognition.start();
-    recognition.onresult = function(event) {
+    recognition.onresult = event => {
       if (!tokenizer) return;
       const transcript = event.results[event.resultIndex][0].transcript;
       const tokens = tokenizer.tokenize(transcript);
       let linked = "";
       tokens.forEach(t => {
         if (t.pos === "名詞") {
           const url = `https://ja.wikipedia.org/wiki/${encodeURIComponent(t.surface_form)}`;
           linked += `<a href="${url}" target="_blank">${t.surface_form}</a>`;
         } else {
           linked += t.surface_form;
         }
       });
       output.innerHTML += `<p>${linked}</p>`;
     };
   </script>
 </body>
 </html>
 
EOF
)
